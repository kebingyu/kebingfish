$(document).ready(function(){function e(){$("#signup-message").find(".text-success").html("").end().find(".text-danger").html("")}function t(e,t){var t=t||"success",r=".text-"+t;$("#signup-message").find(r).html(e).end().modal()}$(".table-striped").on("click",".user-name",function(r){r.preventDefault();var n=$(this),a=n.find("a").text();confirm("Remove "+a+" from this event?")&&$.ajax({url:n.find("a").attr("href"),method:"DELETE",beforeSend:function(){e()}}).done(function(e){return e.ok?($(".badge").text(e.data.goer_count),n.parent().fadeOut(300,function(){$(this).remove()}),void t(a+"'s group has been removed.")):void t(e.error,"danger")})}),$("form.signup").submit(function(r){r.preventDefault();var n=$(this),a=n.attr("action");$.ajax({method:n.attr("method"),url:a,data:n.serialize(),beforeSend:function(){var t=n.find(".has-error");t.find(".error-block").html(""),t.removeClass("has-error"),e()}}).done(function(e){if(e.ok){var r=$(".table-striped tbody");$(".badge").text(e.data.goer_count);var o=n.find('input[name="name"]').val(),i=n.find('input[name="group_size"]').val()||1,d='<tr><td class="user-name"><a href="'+a+"/"+o+'">'+o+'</a></td><td class="user-group-size">'+i+"</td>";if($("th.user-option").length>0){var s=n.find('select[name="option"]').val();d+='<td class="user-option">'+s+"</td>"}return d+="</tr>",r.append(d),void t(o+"'s group has been added.")}t(e.error,"danger")}).fail(function(e){var t=e.responseJSON;for(var r in t){for(var n=$('input[name="'+r+'"]').parents(".form-group"),a=n.find(".error-block"),o=0,i=t[r].length;o<i;o++){var d='<li class="text-danger">'+t[r][o]+"</li>";a.append(d)}n.addClass("has-error")}})}),$(".js-event-reset").on("click",function(e){e.preventDefault();var r=confirm("Reset this event? This is IRREVERSIBLE!");if(0!=r){var n=$(this).attr("href");$.ajax({method:"POST",url:n}).done(function(e){return e.ok?($(".badge").text(e.data.goer_count),$(".table-striped tbody").html(""),void t("Event is reset.")):void t(e.error,"danger")}).fail(function(e){var r=e.responseJSON;for(var n in r)t(r[n],"danger")})}})});